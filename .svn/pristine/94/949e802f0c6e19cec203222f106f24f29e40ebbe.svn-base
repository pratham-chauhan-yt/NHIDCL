$(document).ready(function () {
    $(".js-select2").select2();

    const sixteenYearsAgo = new Date();
    sixteenYearsAgo.setFullYear(sixteenYearsAgo.getFullYear() - 16);
    const formattedDate = sixteenYearsAgo.toISOString().split("T")[0];
    $("#date_of_birth").attr("max", formattedDate);

    initValidation("#personalDetailsForm", {
        title: { required: true },
        name: { required: true },
        personal_email: { required: true, strictEmail: true },
        mobile: { required: true, digits: true, lengthRange: [10, 10] },
        mobile_alternate: { digits: true, lengthRange: [10, 10] },
        date_of_birth: { required: true, date: true, dateLimit: "past" },
        gender: { required: true },
        blood_group: { required: true },
        marital_status: { required: true },
        wedding_date: {
            required: function () {
                return (
                    $("#marital_status").select2("data")[0]?.text.trim() !==
                    "Single"
                );
            },
            date: true,
            dateLimit: "past",
        },
        country_of_birth: { required: true },
        place_of_birth: { required: true },
        religion: { required: true },
        nationality: { required: true },
        category: { required: true },
        ex_serviceman: { required: true },
        disability: { required: true },
        nature_of_disability: {
            required: function () {
                return (
                    $("#disability").select2("data")[0]?.text.trim() === "Yes"
                );
            },
        },
        current_address: { required: true, minlength: 10 },
        permanent_address: { required: true, minlength: 10 },
        emergency_contact_name: { required: true, minlength: 3 },
        emergency_contact_relation: { required: true, minlength: 3 },
        emergency_contact_mobile: {
            required: true,
            digits: true,
            lengthRange: [10, 10],
        },
        emergency_contact_mobile_alternate: {
            required: true,
            digits: true,
            lengthRange: [10, 10],
        },
        emergency_contact_address: { required: true, minlength: 10 },
        nok_contact_name: { required: true, minlength: 3 },
        nok_contact_relation: { required: true, minlength: 3 },
        nok_contact_mobile: {
            required: true,
            digits: true,
            lengthRange: [10, 10],
        },
        nok_contact_mobile_alternate: {
            required: true,
            digits: true,
            lengthRange: [10, 10],
        },
        nok_contact_address: { required: true, minlength: 10 },
        father_name: { required: true, minlength: 3 },
        father_dependent: { required: true },
        mother_name: { required: true, minlength: 3 },
        mother_dependent: { required: true },
        spouse_name: {
            required: function () {
                return (
                    $("#marital_status").select2("data")[0]?.text.trim() !==
                    "Single"
                );
            },
            minlength: 3,
        },
        spouse_dependent: {
            required: function () {
                return (
                    $("#marital_status").select2("data")[0]?.text.trim() !==
                    "Single"
                );
            },
        },
    });

    initValidation("#educationalDetailsForm", {
        examination: { required: true, minlength: 2 },
        institute_name: { required: true, minlength: 3 },
        university_board: { required: true, minlength: 3 },
        passing_year: { required: true },
        percentage_cgpa: { required: true, number: true, range: [0, 100] },
        upload_degree_files: {
            required: true,
            extension: "pdf",
            filesize: 2 * 1024 * 1024,
        },
        upload_degree_txt: { required: true },
    });

    initValidation("#workExperienceDetailsForm", {
        employer_name: { required: true, minlength: 2 },
        post_held: { required: true, minlength: 2, maxlength: 500 },
        from_date: { required: true, date: true, dateLimit: ["past", "today"] },
        to_date: {
            required: true,
            date: true,
            dateLimit: ["past", "today"],
            greaterThan: "#from_date",
        },
        job_description: { required: true, minlength: 10, maxlength: 500 },
        experience_certificate: {
            required: true,
            extension: "pdf",
            filesize: 2 * 1024 * 1024,
        },
        experience_certificate_txt: { required: true },
    });

    initValidation("#trainingDetailsForm", {
        name_of_training: { required: true, minlength: 2, maxlength: 255 },
        training_start_date: {
            required: true,
            date: true,
            dateLimit: ["past", "today"],
        },
        training_end_date: {
            required: true,
            date: true,
            dateLimit: ["past", "today"],
            greaterThan: "#training_start_date",
        },
        description: { required: true, minlength: 5, maxlength: 500 },
        certificate_expiry_date: { date: true, dateLimit: "future" },
        training_certificate: {
            required: true,
            extension: "pdf",
            filesize: 2 * 1024 * 1024,
        },
        training_certificate_txt: { required: true },
    });

    initValidation("#documentUploadForm", {
        upload_profile: {
            required: true,
            extension: "jpg|jpeg|png",
            filesize: 2 * 1024 * 1024,
        },
        upload_profile_txt: { required: true },
        upload_signature: {
            required: true,
            extension: "jpg|jpeg|png",
            filesize: 2 * 1024 * 1024,
        },
        upload_signature_txt: { required: true },
        upload_dob_proof: { required: true, extension: "pdf", filesize: 2 * 1024 * 1024 },
        upload_dob_proof_txt: { required: true },
        upload_resume: { required: true, extension: "pdf", filesize: 2 * 1024 * 1024 },
        upload_resume_txt: { required: true },
        upload_pancard: {
            required: true,
            extension: "pdf|jpg|jpeg|png",
            filesize: 2 * 1024 * 1024,
        },
        upload_pancard_txt: { required: true },
        upload_aadhar: {
            required: true,
            extension: "pdf|jpg|jpeg|png",
            filesize: 2 * 1024 * 1024,
        },
        upload_aadhar_txt: { required: true },
        upload_address: {
            required: true,
            extension: "pdf|jpg|jpeg|png",
            filesize: 2 * 1024 * 1024,
        },
        upload_address_txt: { required: true },
        upload_caste_certificate_txt: {
            required: false,
            extension: "pdf|jpg|jpeg|png",
            filesize: 2 * 1024 * 1024,
        },
        marriage_certificate: {
            required: false,
            extension: "pdf|jpg|jpeg|png",
            filesize: 2 * 1024 * 1024,
        },
    });

    initValidation("#employerDetailsForm", {
        user_type: { required: true },
        official_email: {
            required: true,
            email: true,
            domainAllowed: ["nhidcl.com", "nic.in"],
        },
        ref_employee_type_id: { required: true },
        date_of_joining: {
            required: true,
            date: true,
            dateLimit: ["past", "today"],
        },
        ref_designation_id: { required: true },
        ref_department_id: { required: true },
        user_code: { required: true, minlength: 2, maxlength: 50 },
        level_id: { required: true },
        probation_period: { required: true, digits: true, range: [0, 24] },
        confirmation_date: {
            required: true,
            date: true,
            greaterThan: "#date_of_joining",
        },
        reporting_officer_id: { required: true },
        ref_posting_location_id: { required: true },
        upload_salary_slip: {
            required: true,
            extension: "pdf",
            filesize: 2 * 1024 * 1024,
        },
        upload_salary_slip_txt: { required: true },
        upload_offer_letter: {
            required: true,
            extension: "pdf",
            filesize: 2 * 1024 * 1024,
        },
        upload_offer_letter_txt: { required: true },
        upload_nda_agreement: {
            required: true,
            extension: "pdf",
            filesize: 2 * 1024 * 1024,
        },
        upload_nda_agreement_txt: { required: true },
        upload_background_verification: {
            required: true,
            extension: "pdf",
            filesize: 2 * 1024 * 1024,
        },
        upload_background_verification_txt: { required: true },
        upload_disciplinary_status: {
            required: true,
            extension: "pdf",
            filesize: 2 * 1024 * 1024,
        },
        upload_disciplinary_status_txt: { required: true },
        upload_vigilance_clearance: {
            required: true,
            extension: "pdf",
            filesize: 2 * 1024 * 1024,
        },
        upload_vigilance_clearance_txt: { required: true },
        upload_medical_fitness: {
            required: true,
            extension: "pdf",
            filesize: 2 * 1024 * 1024,
        },
        upload_medical_fitness_txt: { required: true },
        // "role[]": { required: true },
    });

    $("#same_as_emergency_contact").on("change", function () {
        const isChecked = $(this).is(":checked");

        const fields = [
            "contact_name",
            "contact_relationship",
            "contact_mobile",
            "contact_alternate_number",
            "contact_address",
        ];

        fields.forEach(function (field) {
            const cVal = $(`#emergency_${field}`).val();
            const $nokField = $(`#nok_${field}`);

            if (isChecked) {
                $nokField.val(cVal).prop("readonly", true);
            } else {
                $nokField.prop("readonly", false);
            }
        });
    });

    /* ======================================================
       PERSONAL DETAILS TOGGLING LOGIC
       ====================================================== */

    const PERSONAL_FIELDS = {
        wedding_date: $("#field_wedding_date"),
        spouse_name: $("#field_spouse_name"),
        spouse_dependent: $("#field_spouse_dependent"),
    };

    const PERSONAL_CONFIG = {
        Single: { hide: ["wedding_date", "spouse_name", "spouse_dependent", "field_children_name", "field_children_dependent"] },
        Divorced: { hide: [] },
        Widowed: { hide: ["spouse_dependent"] },
        Married: { hide: [] },
        default: { hide: ["wedding_date", "spouse_name", "spouse_dependent", "field_children_name", "field_children_dependent"] },
    };

    $("#marital_status").on("change", function () {
        toggleFieldsByRules(PERSONAL_CONFIG, PERSONAL_FIELDS, this);
    });
    toggleFieldsByRules(PERSONAL_CONFIG, PERSONAL_FIELDS, "#marital_status");

    const DISABILITY_FIELDS = {
        nature_of_disability: $("#field_nature_of_disability"),
    };

    const DISABILITY_CONFIG = {
        Yes: { hide: [] },
        No: { hide: ["nature_of_disability"] },
        default: { hide: ["nature_of_disability"] },
    };

    $("#disability").on("change", function () {
        toggleFieldsByRules(DISABILITY_CONFIG, DISABILITY_FIELDS, this);
    });
    toggleFieldsByRules(DISABILITY_CONFIG, DISABILITY_FIELDS, "#disability");

     // ======================================================
    // DOCUMENT UPLOAD TOGGLING LOGIC
    // ======================================================

    const DOC_FIELDS = {
        marriage_certificate: $("#field_marriage_certificate")
    };

    const DOC_CONFIG = {
        "Married": { hide: [] },
        "Single": { hide: ["marriage_certificate"] },
        "Divorced": { hide: [] },
        "Widowed": { hide: [] },
        "default": { hide: ["marriage_certificate"] }
    };

    // Sync with Marital Status in Personal Tab
    $("#marital_status").on("change", function () {
        toggleFieldsByRules(DOC_CONFIG, DOC_FIELDS, this);
    });
    toggleFieldsByRules(DOC_CONFIG, DOC_FIELDS, "#marital_status");
});
