@extends('layouts.dashboard')
@section('dashboard_content')
    <section class="home-section ">
        <div class="container-fluid md:p-0">
            <div class="top_heading_dash__">
                <div class="main_hed">Query Details</div>
                <div class="plain_dlfex bg_elips_ic">
                    <button type="button" onclick="history.back();"
                        class="hover-effect-btn fill_btn">{{ __('Back') }}</button>
                </div>
            </div>
        </div>
        <div class="inner_page_dash__">
            <h1 class="candidat_cust-title">{{ $queryDetails->title }}</h1>
            <div class="my-4">
                @include('components.alert')
                <div id="Home" class="tabcontent">
                    <div class="candidat_cust-dates">
                        <p>Query ID: <br /><span class="text-red-500">{{ $queryDetails->query_id }}</span></p>
                        <p>Query Type: <br /><span>{{ $queryDetails->queryType->query_type }}</span></p>
                        <p>Status: <br>
                            <span @class([
                                'badge',
                                'badge-warning' =>
                                    strcasecmp($queryDetails->status->status, 'Pending_query') === 0,
                                'badge-success' =>
                                    strcasecmp($queryDetails->status->status, 'Pending_query') !== 0,
                            ])>
                                {{ strcasecmp($queryDetails->status->status, 'Pending_query') === 0 ? 'Pending' : 'Resolved' }}
                            </span>
                        </p>
                        <p>
                            Supporting Document: <br />
                            @if (isset($queryDetails->supporting_document))
                                @php
                                    $FilePath = 'uploads/query-management/';
                                    $FileName = basename($queryDetails->supporting_document);
                                    $FileUrl = route('qms.view-file', [
                                        'pathName' => $FilePath,
                                        'fileName' => $FileName,
                                    ]);
                                @endphp
                                <a href="{{ $FileUrl }}" target="_blank" data-bs-toggle="tooltip"
                                    title="View query file">
                                    <i class="fa fa-file mx-1" aria-hidden="true"></i>
                                </a>
                            @else
                                -
                            @endif
                        </p>
                        <p>Query Raise on: <br /><span>{{ $queryDetails->created_at->format('d M Y') }}</span></p>
                        <p>Query Raised By: <br /><span>{{ $queryDetails->createdBy->name }} <br>
                                ({{ $queryDetails->createdBy->email }})</span></p>
                    </div>

                    <hr class="my-3" />

                    <p class="text-sm"><strong>Note:-</strong> <span
                            class="text-gray-600">{{ $queryDetails->description }}</span></p>

                    <div class="table_over mt-4">
                        <h4 class="candidat_cust-title">List of replies:-</h4>
                        @php
                            use Illuminate\Support\Facades\Crypt;
                            $encryptedId = Crypt::encryptString($queryDetails->id);
                        @endphp


                        <table class="cust_table__ table_sparated" id="queryRepliedTable">
                            <div id="query" data-id="{{ urlencode($encryptedId) }}"></div>
                            <thead class="">
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">Reply/Comment</th>
                                    <th scope="col">File</th>
                                    <th scope="col">User (Replied By)</th>
                                    <th>Replied Date</th>
                                </tr>
                            </thead>
                            <tbody class="">
                            </tbody>
                        </table>
                    </div>
                    @if (strcasecmp($queryDetails->status->status, 'Pending_query') == 0)
                        <hr class="mt-5 mx-12" />

                        <form class="form_grid_cust mt-4" enctype="multipart/form-data"
                            action="{{ route('qms.store-query-reply') }}" method="POST" id="queryReplyForm">
                            @csrf
                            <div class="inpus_cust_cs form_grid_dashboard_cust_">
                                <div class="">
                                    <input type="hidden" name="query_details_id" value="{{ $queryDetails->id }}">
                                    <div id="toolbar-container"></div>
                                    <div id="editor-container" style="height: 300px;"></div>

                                    {{-- Hidden input to hold Quill HTML content --}}
                                    <input type="hidden" name="description" value="{{ old('description') }}"
                                        id="description">

                                </div>
                                <x-form.file-upload label="Document" name="upload_doc"
                                smallLabel="PDF file only, with a max size of 2 MB" smallLabelClass="text-yellow-message" />

                                <div
                                    class="inpus_cust_cs form_grid_dashboard_cust_ grid check_box_input grid-cols-1 mt-4 p-2">
                                    <div class="">
                                        <div class="flex gap-[10px]">
                                            <button type="submit" title="submit-button" value="submit"
                                                class="hover-effect-btn border_btn">
                                                Submit Reply
                                            </button>
                                            <button type="submit" value="resolve" title="submit-button"
                                                class="hover-effect-btn border_btn">
                                                Mark as Resolved
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    @endif
                </div>
            </div>
        </div>
    </section>
@endsection

@push('styles')
    <link rel="stylesheet" href="{{ asset('public/css/flowbite.min.css') }}">
    <link rel="stylesheet" href="{{ asset('public/css/quill.snow.css') }}">
    <link rel="stylesheet" href="{{ asset('public/css/quill-render.css') }}">
@endpush
@push('scripts')
    <script src="{{ asset('public/js/utils/fileUpload.js') }}"></script>
    <script src="{{ asset('public/js/quill.js') }}"></script>
    {{-- <script src="{{ asset('public/js/image-resize.min.js') }}"></script> --}}
    <script src="{{ asset('public/validation/query-management/query-details.js') }}"></script>
@endpush
