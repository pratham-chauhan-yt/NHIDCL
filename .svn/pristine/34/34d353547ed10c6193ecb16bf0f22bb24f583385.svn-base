function openPage(pageName, elmnt, color) {
    var tabcontent = document.getElementsByClassName("tabcontent");
    for (var i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }
    var tablinks = document.querySelectorAll(".tab_custom_c button");
    tablinks.forEach(function (btn) {
        btn.classList.remove("active");
    });
    document.getElementById(pageName).style.display = "block";
    elmnt.classList.add("active");
    if (pageName === "Pending") {
        loadTable("pending_query", "#pendingQueriesTable");
    } else if (pageName === "Resolved") {
        loadTable("resolved_query", "#resolvedQueriesTable");
    }
}
$(document).ready(function () {
    const websiteMeta = document.querySelector('meta[name="website-url"]');
    const websiteUrl = websiteMeta?.getAttribute("content");
    const finalUrl = websiteUrl
        ? `${websiteUrl}/query-management/create`
        : null;
    window.loadTable = function (status = null, tableId = "") {
        $(tableId).DataTable({
            processing: true,
            serverSide: true,
            destroy: true,
            ajax: {
                url: finalUrl,
                data: {
                    status: status,
                },
            },
            columns: [
                {
                    data: "DT_RowIndex",
                    name: "DT_RowIndex",
                    orderable: false,
                    searchable: false,
                },
                { data: "query_id", name: "query_id" },
                { data: "title", name: "title" },
                { data: "query_type", name: "query_type" },
                { data: "created_at", name: "created_at" },
                {
                    data: "action",
                    name: "action",
                    orderable: false,
                    searchable: false,
                },
            ],
        });
    };

    // loadTable();
    document
        .getElementById("defaultOpen")
        ?.addEventListener("click", function () {
            loadTable();
        });

    let formId = $("#addQuery").length ? "#addQuery" : "#editQuery";
    $(formId).validate({
        rules: {
            title: {
                required: true,
                maxlength: 150,
            },
            query_type: {
                required: true,
            },
            description: {
                required: true,
                maxlength: 250,
            },
        },
        messages: {
            title: {
                required: "Please enter the Title",
                maxlength: "Character limit of 150 exceeded",
            },
            query_type: {
                required: "Please enter the Query Type",
            },
            description: {
                required: "Please enter the Description",
                maxlength: "Character limit of 250 exceeded",
            },
        },
        errorElement: "div",
        errorPlacement: function (error, element) {
            error.addClass("error-message");
            error.insertAfter(element);
        },
        submitHandler: function (form) {
            form.submit();
        },
    });

    initFileUpload({
        inputSelector: ".upload_doc",
        allowedTypes: ["application/pdf"],
        allowedExt: ["pdf"], // optional fallback
        allowedTypesText: "PDF",
        maxSize: 2 * 1024 * 1024, // 2 MB
        maxSizeText: "2MB",
        formDataKey: "upload_doc",
        uploadUrl: "query-management/upload-file",
        viewUrl: "query-management/view-file",
        pathName: "uploads/query-management/",
        sectionClass: ".attachment_section_upload_doc",
        hideClass: ".hide_upload_doc_btn",
        hiddenInput: "#upload_doc_url",
        viewClass: "report_preview_support_photo",
        removeClass: "report_remove_doc",
        prefix: "upload_doc",
        single: true,
    });
});
