function openPage(pageName, elmnt, color) {
    var tabcontent = document.getElementsByClassName("tabcontent");
    for (var i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }
    var tablinks = document.querySelectorAll(".tab_custom_c button");
    tablinks.forEach(function (btn) {
        btn.classList.remove("active");
    });
    document.getElementById(pageName).style.display = "block";
    elmnt.classList.add("active");
    if (pageName === "Knowledgebase") {
        loadTable("knowledgebase query", "#knowledgebaseTable");
    }
}
const websiteMeta = document.querySelector('meta[name="website-url"]');
const websiteUrl = websiteMeta?.getAttribute("content");
const finalUrl = websiteUrl
    ? `${websiteUrl}/query-management/knowledge-base`
    : null;
window.loadTable = function (status = null, tableId = "") {
    $(tableId).DataTable({
        processing: true,
        serverSide: true,
        destroy: true,
        ajax: {
            url: finalUrl,
            // data: {
            //     status: status,
            // },
        },
        columns: columnsForTable,
    });
};

$(document).ready(function () {
    loadTable();
    document
        .getElementById("defaultOpen")
        ?.addEventListener("click", function () {
            loadTable();
        });
});

// Define the dynamic columns for the DataTable
let columnsForTable = [];

columnsForTable = [
    {
        data: "DT_RowIndex",
        name: "DT_RowIndex",
        orderable: false,
        searchable: false,
    },
    { data: "query_id", name: "query_id" },
    { data: "title", name: "title" },
    { data: "meta_title", name: "meta_title" },
    { data: "created_at", name: "created_at" },
    { data: "created_by", name: "created_by" },
    {
        data: "action",
        name: "action",
        orderable: false,
        searchable: false,
    },
];

// Add Knowledgebase Query
$(document).ready(function () {
    let formId = $("#knowledgeBaseQueryForm").length
        ? "#knowledgeBaseQueryForm"
        : "#editKnowledgeBaseQueryForm";
    $(formId).validate({
        rules: {
            title: {
                required: true,
                maxlength: 150,
            },
            meta_title: {
                required: true,
                maxlength: 60,
            },
            description: {
                required: true,
                maxlength: 250,
            },
            meta_description: {
                required: true,
                maxlength: 160,
            },
        },
        messages: {
            title: {
                required: "Please enter the Title",
                maxlength: "Character limit of 150 exceeded",
            },
            description: {
                required: "Please enter the Description",
                maxlength: "Character limit of 250 exceeded",
            },
            meta_title: {
                required: "Please enter the Meta Title",
                maxlength: "Character limit of 60 exceeded",
            },
            meta_description: {
                required: "Please enter the Meta Description",
                maxlength: "Character limit of 160 exceeded",
            },
        },
        errorElement: "div",
        errorPlacement: function (error, element) {
            error.addClass("error-message");
            error.insertAfter(element);
        },
        submitHandler: function (form) {
            form.submit();
        },
    });

    initFileUpload({
        inputSelector: ".upload_doc",
        allowedTypes: ["application/pdf"],
        allowedExt: ["pdf"], // optional fallback
        allowedTypesText: "PDF",
        maxSize: 2 * 1024 * 1024, // 2 MB
        maxSizeText: "2MB",
        formDataKey: "upload_doc",
        uploadUrl: "query-management/upload-file",
        viewUrl: "query-management/view-file",
        pathName: "uploads/qms-knowladgebase-file/",
        sectionClass: ".attachment_section_upload_doc",
        hideClass: ".hide_upload_doc_btn",
        hiddenInput: "#upload_doc_url",
        viewClass: "report_preview_support_photo",
        removeClass: "report_remove_doc",
        prefix: "upload_doc",
        single: true,
    });
});
